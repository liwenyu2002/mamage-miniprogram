<view class="page">

  <!-- 选择项目：搜索框 + 最新项目列表 -->
  <view class="section">
    <view class="label">选择项目</view>

    <view class="search-box">
      <input
        class="search-input"
        placeholder="输入项目名称搜索"
        value="{{searchText}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
    </view>

    <view class="hint">
      最新 {{displayProjects.length >= 5 ? 5 : displayProjects.length}} 个项目（下滑加载更多）
    </view>

    <view class="project-list">
      <block wx:for="{{displayProjects}}" wx:key="id">
        <view
          class="project-item {{item.id === selectedProjectId ? 'active' : ''}}"
          data-id="{{item.id}}"
          data-name="{{item.projectName}}"
          bindtap="selectProject"
        >
          <view class="project-name">
            {{item.projectName}}
          </view>
          <view class="project-meta">
            {{item.createdAt.slice(0, 10)}} · {{item.status}}
          </view>
        </view>
      </block>

      <view class="load-more-tip" wx:if="{{loadingMore}}">
        正在加载更多项目…
      </view>
    </view>
  </view>

  <!-- 选择图片 -->
  <view class="section">
    <view class="label">
      上传图片
      <text class="count">（已选 {{images.length}} 张）</text>
    </view>

    <view class="img-grid">
      <block wx:for="{{images}}" wx:key="*this">
        <image src="{{item}}" class="thumb" mode="aspectFill" />
      </block>

      <view class="thumb add" bindtap="chooseImages">
        <text class="add-text">+ 选择图片</text>
      </view>
    </view>
  </view>

  <!-- 上传按钮 -->
  <button
    class="upload-btn"
    type="primary"
    loading="{{uploading}}"
    bindtap="uploadAll"
  >
    {{ uploading ? '正在上传...' : '开始上传' }}
  </button>
</view>
